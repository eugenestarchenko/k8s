{{- $ := . }}
name: reloader

image: {{ include "nats.image" .Values.nats.reloader.image }}
imagePullPolicy: {{ .Values.nats.reloader.image.pullPolicy }}

{{- with .Values.nats.reloader.env }}
env:
{{- include "nats.env" . }}
{{- end }}

args:
- -pid
- /var/run/nats/nats.pid
- -config
- /etc/nats-config/nats.conf
{{ include "nats.reloaderConfig" (dict "config" .config "dir" "/etc/nats-config") }}

volumeMounts:
- name: pid
  mountPath: /var/run/nats
{{- range $mnt := .natsVolumeMounts }}
{{- range $.Values.nats.reloader.natsVolumeMountPrefixes }}
{{- if (hasPrefix . $mnt.mountPath) }}
- {{ toYaml $mnt | nindent 2}}
{{- break }}
{{- end }}
{{- end }}
{{- end }}
