{{- $ := . }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.natsBox.contextSecret.name | default (printf "%s-box-context" (include "nats.fullname" $)) }}
  labels:
    {{- include "nats.labels" . | nindent 4 }}
    app.kubernetes.io/component: nats-box-context
type: Opaque
stringData:
{{- range $ctxKey, $ctxVal := .Values.natsBox.context }}
  "{{ $ctxKey }}.json": |
    {{- include "toPrettyRawJson" (include "nats.loadMergePatch" (merge (dict "file" "nats-box/context-secret/context.yaml" "ctx" (merge (dict "contextName" $ctxKey "context" $ctxVal) $)) $ctxVal) | fromYaml) | nindent 4 }}
{{- end }}
