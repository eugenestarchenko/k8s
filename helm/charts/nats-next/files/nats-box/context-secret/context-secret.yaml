apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.natsBox.contextSecret.name }}
  labels:
    {{- include "natsBox.labels" $ | nindent 4 }}
type: Opaque
stringData:
{{- range $ctxKey, $ctxVal := .Values.natsBox.context }}
  "{{ $ctxKey }}.json": |
    {{- include "toPrettyRawJson" (include "nats.loadMergePatch" (merge (dict "file" "nats-box/context-secret/context.yaml" "ctx" (merge (dict "contextName" $ctxKey "context" $ctxVal) $)) $ctxVal) | fromYaml) | nindent 4 }}
{{- end }}
